{% extends "base.html" %}
{% block title %}Notities â€” {{ SITE_NAME }}{% endblock %}
{% block content %}
  <h1>Mijn notities</h1>

  <p><a href="{% url 'notes:new' %}">Nieuwe notitie</a></p>

  <section style="margin: 1rem 0; padding: .75rem; border: 1px solid #ccc; border-radius: .5rem; background: #fafafa; display:flex; flex-wrap:wrap; gap:1rem;">
    <div>
      <strong>Filter op tag:</strong>
      <a
        href="{% url 'notes:list' %}{% if q %}?q={{ q|urlencode }}{% endif %}"
        style="margin-left:.5rem;{% if not active_tag %} font-weight:bold; text-decoration:underline; {% endif %}"
      >
        alles
      </a>

      {% for t in all_tags %}
        {# combineer tag + q in de link #}
        <a
          href="{% url 'notes:list' %}?tag={{ t.name|urlencode }}{% if q %}&q={{ q|urlencode }}{% endif %}"
          style="margin-left:.5rem;{% if active_tag and active_tag|lower == t.name|lower %} font-weight:bold; text-decoration:underline; {% endif %}"
        >
          {{ t.name }}
        </a>
      {% empty %}
        <em style="margin-left:.5rem;">Geen notities met tag</em>
      {% endfor %}
    </div>

    <form method="get" action="{% url 'notes:list' %}" style="margin-left:auto;">
      {# als er al een tag actief is, hou die vast als hidden input #}
      {% if active_tag %}
        <input type="hidden" name="tag" value="{{ active_tag }}">
      {% endif %}

      <input
        type="text"
        name="q"
        value="{{ q }}"
        placeholder="Zoek in titel / inhoud"
        style="padding:.3rem .5rem;"
      />
      <button type="submit" style="padding:.3rem .6rem;">Zoek</button>
    </form>
  </section>

  {% if active_tag or q %}
    <p>
      {% if active_tag %}
        Gefilterd op tag: <strong>{{ active_tag }}</strong>.
      {% endif %}
      {% if q %}
        Zoekterm: <strong>{{ q }}</strong>.
      {% endif %}
    </p>
  {% endif %}

  <ul>
  {% for n in notes %}
    <li style="margin-bottom: .5rem;">
      <a href="{% url 'notes:detail' n.pk %}">{{ n.title }}</a>

      {% if n.is_public %}
        <span style="color:green; font-size:.8rem; margin-left:.4rem;">
          (publiek)
        </span>
      {% endif %}

      {% if n.tags.all %}
        {% for t in n.tags.all %}
          <span style="
              display:inline-block;
              padding:.1rem .4rem;
              border:1px solid #ddd;
              border-radius:.4rem;
              font-size:.8rem;
              margin-left:.4rem;
              background-color:#f8f8f8;
            ">
            {{ t.name }}
          </span>
        {% endfor %}
      {% endif %}
    </li>
  {% empty %}
    <li>
      Geen notities met tag
      {% if active_tag %} met tag "{{ active_tag }}"{% endif %}
      {% if q %} die "{{ q }}" bevatten{% endif %}
    </li>
  {% endfor %}
</ul>
{% endblock %}
